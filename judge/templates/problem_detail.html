{% extends 'base.html' %}
{% block title %}{{ problem.name }} â€“ CodeVerse{% endblock %}

{% block content %}
<style>
  .split-container {
    display: flex;
    height: calc(100vh - 100px);
    overflow: hidden;
  }
  .left-pane {
    width: 40%;
    min-width: 300px;
    max-width: 70%;
    padding: 1rem;
    overflow-y: auto;
  }
  .right-pane {
    flex-grow: 1;
    padding: 1rem;
    overflow-y: auto;
  }

  /* ğŸ”¹ Sleek blue, dotted vertical splitter */
  .resizer {
    width: 4px;
    cursor: ew-resize;
    background-color: #1a2b4c;
    background-image: radial-gradient(circle, #4da6ff 1px, transparent 1px);
    background-size: 2px 6px;
    background-repeat: repeat-y;
    transition: background-color .2s, transform .2s;
  }
  .resizer:hover {
    background-color: #263b6e;
    transform: scaleX(1.1);
  }

  #editor {
    height: 300px;
    border: 1px solid #007bff;
    border-radius: .5rem;
  }

  /* scrollbars */
  .left-pane::-webkit-scrollbar,
  .right-pane::-webkit-scrollbar {
    width: 6px;
  }
  .left-pane::-webkit-scrollbar-thumb,
  .right-pane::-webkit-scrollbar-thumb {
    background-color: #4da6ff;
    border-radius: 3px;
  }

  /* custom-input styling */
  #custom-input {
    background: #fff;
    color: #000;
  }
  #custom-input::placeholder {
    color: #666;
    opacity: 1;
  }
  /* Monaco scrollbar styling */
  .monaco-scrollable-element > .scrollbar > .slider {
    background: #4da6ff !important;
    border-radius: 3px !important;
  }

  /* Monaco draggers (sashes) - usually invisible unless in split editor mode */
  .monaco-sash {
    width: 3px !important;
    height: 3px !important;
    background: transparent !important;
  }
  .monaco-sash:hover {
    background: #4da6ff !important;
    opacity: 0.5 !important;
  }

</style>

<div class="split-container">
  <!-- Problem description -->
  <div class="left-pane">
    <div class="problem-card">
      <div class="problem-card-title">ğŸ§  {{ problem.name }}</div>
      <div class="problem-card-meta mb-2">
        Code: <code>{{ problem.code }}</code> |
        Difficulty:
          <span class="badge
          {% if problem.difficulty == 'E' %}bg-success text-light
          {% elif problem.difficulty == 'M' %}bg-warning text-dark
          {% elif problem.difficulty == 'H' %}bg-danger text-light
          {% else %}bg-secondary text-light{% endif %}">
          {{ problem.get_difficulty_display }}
        </span>
      </div>
      
      <h5>ğŸ“ Description</h5>
      <p style="white-space: pre-wrap;">{{ problem.description }}</p>
      
      <h5>ğŸ”½ Input Format</h5>
      <pre>{{ problem.input_format }}</pre>
      
      <h5>ğŸ”¼ Output Format</h5>
      <pre>{{ problem.output_format }}</pre>
      
      <h5>ğŸ“Œ Constraints</h5>
      <pre>{{ problem.constraints }}</pre>
      
      <h5>ğŸ”‚ Sample Input</h5>
      <pre>{{ problem.sample_input }}</pre>
      
      <h5>ğŸ” Sample Output</h5>
      <pre>{{ problem.sample_output }}</pre>
      
    </div>
  </div>

  <!-- the one, thin vertical splitter -->
  <div class="resizer" id="resizer"></div>

  <!-- Code workspace -->
  <div class="right-pane">
    <div class="problem-card">
      <div class="problem-card-title">ğŸš€ Code Workspace</div>
      <form id="submission-form" method="post">
        {% csrf_token %}
        <div class="mb-2">
          <label>Language:</label>
          <select name="language" id="language"
                  class="form-select w-auto d-inline-block ms-2">
            <option value="java">Java</option>
            <option value="python">Python</option>
            <option value="cpp">C++</option>
            <option value="c">C</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Your Code:</label>
          <div id="editor"></div>
          <textarea name="code" id="hidden-code" hidden></textarea>
        </div>
        <div class="mb-2">
          <label>ğŸ“¥ Custom Input:</label>
          <textarea id="custom-input" class="form-control"
                    rows="3" placeholder="Enter custom inputâ€¦"></textarea>
        </div>
        <div class="mb-2">
          <label>ğŸ“¤ Output:</label>
          <textarea id="custom-output" class="form-control"
                    rows="4" readonly></textarea>
        </div>
        <div class="d-flex gap-3">
          <button type="button" class="btn btn-outline-primary"
                  id="run-button">â–¶ï¸ Run Code</button>
          <button type="submit" class="btn btn-success">âœ… Submit</button>
        </div>
      </form>
    </div>
  </div>


</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script>
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
  require(['vs/editor/editor.main'], function() {
    window.editor = monaco.editor.create(
      document.getElementById('editor'),
      {
        value: '',
        language: 'java',
        theme: 'vs-dark',
        automaticLayout: true,
    
        minimap: {
          enabled: false
        },
    
        scrollBeyondLastLine: false,
        overviewRulerLanes: 0,
        lineDecorationsWidth: 0,
    
        // Make scrollbars thin
        scrollbar: {
          verticalScrollbarSize: 4,
          horizontalScrollbarSize: 4,
          useShadows: false,
        },
    
        // Prevent internal sashes showing up (if they are active)
        renderLineHighlight: "none",
        guides: {
          indentation: false
        }
      }
    );
    

    // boilerplate snippets
    const boilerplate = {
      java: `import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        // Your code here


        sc.close();
    }
}
`,
      python: `# Read input from stdin
def main():
    # Your code here
    

    pass

if __name__ == "__main__":
    main()
`,
      cpp: `#include <bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    // Your code here




    return 0;
}
`,
      c: `#include <stdio.h>

int main() {
    // Your code here


    return 0;
}
`
    };

    const langSel = document.getElementById('language');
    function loadTemplate() {
      editor.setValue(boilerplate[langSel.value] || '');
    }
    langSel.addEventListener('change', loadTemplate);
    loadTemplate();

    document.getElementById('submission-form')
      .addEventListener('submit', ()=>{
        document.getElementById('hidden-code').value = editor.getValue();
      });

    document.getElementById('run-button')
      .addEventListener('click', ()=>{
        const data = new FormData();
        data.append('code', editor.getValue());
        data.append('language', langSel.value);
        data.append('custom_input', document.getElementById('custom-input').value);
        fetch('/run-code/', {
          method: 'POST',
          headers: { 'X-CSRFToken':'{{ csrf_token }}' },
          body: data
        })
        .then(res=>res.json())
        .then(json=> {
          document.getElementById('custom-output').value =
            json.output || json.details || json.error || '';
        });
      });
  });

  // â€”â€”â€” vertical splitter logic â€”â€”â€”
  const rz = document.getElementById('resizer'),
        lp = rz.previousElementSibling;
  let dragging = false;
  rz.onmousedown = ()=>{ dragging=true; document.body.style.cursor='ew-resize'; };
  document.onmousemove = e=>{
    if (!dragging) return;
    let newW = e.clientX - lp.parentNode.offsetLeft;
    if (newW > 250 && newW < window.innerWidth*0.7) {
      lp.style.width = newW + 'px';
    }
  };
  document.onmouseup = ()=>{ dragging=false; document.body.style.cursor=''; };
</script>
{% endblock %}
