{% extends 'base.html' %}
{% block title %}{{ problem.name }} ‚Äì CodeVerse{% endblock %}

{% block content %}
<style>
  .split-container {
    display: flex;
    height: calc(100vh - 100px);
    overflow: hidden;
  }

  .left-pane {
    width: 40%;
    min-width: 300px;
    max-width: 70%;
    padding: 1rem;
    overflow-y: auto;
  }

  .right-pane {
    flex-grow: 1;
    padding: 1rem;
    overflow-y: auto;
  }

  /* üîπ Sleek Blue Vertical Separator */
  .resizer {
    width: 6px;
    cursor: ew-resize;
    background-color: #1a2b4c;
    background-image: radial-gradient(circle, #4da6ff 1.2px, transparent 1.2px);
    background-size: 4px 8px;
    background-repeat: repeat-y;
    border-left: 1px solid #4da6ff33;
    border-right: 1px solid #4da6ff33;
    transition: background-color 0.2s, transform 0.2s ease;
  }

  .resizer:hover {
    background-color: #263b6e;
    transform: scaleX(1.05);
  }

  #editor {
    height: 300px;
    border: 1px solid #007bff;
    border-radius: 0.5rem;
  }

  /* üî∏ Right Pane Scrollbar (Code Workspace) - consistent dark theme */
  .right-pane::-webkit-scrollbar {
    width: 8px;
  }

  .right-pane::-webkit-scrollbar-track {
    background: #0e1a33;
  }

  .right-pane::-webkit-scrollbar-thumb {
    background-color: #4da6ff;
    border-radius: 4px;
  }

  .right-pane::-webkit-scrollbar-thumb:hover {
    background-color: #80cfff;
  }

  /* Optional: Match left-pane too */
  .left-pane::-webkit-scrollbar {
    width: 8px;
  }

  .left-pane::-webkit-scrollbar-thumb {
    background-color: #4da6ff;
    border-radius: 4px;
  }

  #custom-input {
    background-color: #ffffff; /* white background for clarity */
    color: #000000; /* black text */
  }
  
  #custom-input::placeholder {
    color: #666666; /* darker grey placeholder for visibility */
    opacity: 1; /* ensure placeholder is fully visible */
  }
  

</style>


<div class="split-container">
  <!-- üîπ Problem Description -->
  <div class="left-pane">
    <div class="problem-card">
      <div class="problem-card-title">üß† {{ problem.name }}</div>
      <div class="problem-card-meta mb-2">
        Code: <code class="problem-code">{{ problem.code }}</code> |
        Difficulty:
        <span class="badge 
          {% if problem.difficulty == 'E' %}badge-easy
          {% elif problem.difficulty == 'M' %}badge-medium
          {% else %}badge-hard
          {% endif %}">
          {{ problem.get_difficulty_display }}
        </span>
      </div>
      <h5 class="mb-2">üìù Problem Statement</h5>
      <p style="white-space: pre-wrap;">{{ problem.statement }}</p>
    </div>
  </div>

  <!-- üîÅ Drag Handle -->
  <div class="resizer" id="resizer"></div>

  <!-- üî∏ Code Workspace -->
  <div class="right-pane">
    <div class="problem-card">
      <div class="problem-card-title">üöÄ Code Workspace</div>
      <form id="submission-form" method="post">
        {% csrf_token %}

        <div class="mb-2">
          <label for="language">Language:</label>
          <select name="language" id="language" class="form-select w-auto d-inline-block ms-2" required>
            <option value="java">Java</option>
            <option value="python">Python</option>
            <option value="cpp">C++</option>
            <option value="c">C</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="code">Your Code:</label>
          <div id="editor"></div>
          <textarea name="code" id="hidden-code" style="display: none;"></textarea>
        </div>

        <div class="mb-2">
          <label for="custom-input">üì• Custom Input:</label>
          <textarea id="custom-input" class="form-control" rows="3" placeholder="Enter custom input..."></textarea>
        </div>

        <div class="mb-2">
          <label for="custom-output">üì§ Output:</label>
          <textarea id="custom-output" class="form-control" rows="4" readonly></textarea>
        </div>

        <div class="d-flex gap-3">
          <button type="button" class="btn btn-outline-primary" id="run-button">‚ñ∂Ô∏è Run Code</button>
          <button type="submit" class="btn btn-success">‚úÖ Submit Code</button>
        </div>
      </form>

      {% if verdict %}
        <div class="mt-3 alert alert-info">
          <strong>üßæ Verdict:</strong> {{ verdict }}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  // üí° Make the vertical divider draggable
  const resizer = document.getElementById('resizer');
  const leftPane = resizer.previousElementSibling;
  const rightPane = resizer.nextElementSibling;

  let isResizing = false;

  resizer.addEventListener('mousedown', function (e) {
    isResizing = true;
    document.body.style.cursor = 'ew-resize';
  });

  document.addEventListener('mousemove', function (e) {
    if (!isResizing) return;

    const containerOffsetLeft = leftPane.parentNode.offsetLeft;
    const newLeftWidth = e.clientX - containerOffsetLeft;

    if (newLeftWidth < 250 || newLeftWidth > window.innerWidth * 0.7) return;

    leftPane.style.width = `${newLeftWidth}px`;
  });

  document.addEventListener('mouseup', function () {
    isResizing = false;
    document.body.style.cursor = 'default';
  });
</script>

<script>
  document.getElementById('run-button').addEventListener('click', function() {
      const code = editor.getValue();  // assuming Monaco
      const language = document.getElementById('language').value;
      const customInput = document.getElementById('custom-input').value;
  
      const formData = new FormData();
      formData.append('code', code);
      formData.append('language', language);
      formData.append('custom_input', customInput);
  
      fetch('/run-code/', {
          method: 'POST',
          headers: {
              'X-CSRFToken': '{{ csrf_token }}'
          },
          body: formData
      })
      .then(res => res.json())
      .then(data => {
          const output = data.output || data.details || data.error;
          document.getElementById('custom-output').value = output;
      })
      .catch(err => {
          document.getElementById('custom-output').value = '‚ö†Ô∏è Error occurred: ' + err;
      });
  });
  </script>
  
  <script>
  // Boilerplate code snippets for each language
  const boilerplateCode = {
    java: `import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        // Your code here
        sc.close();
    }
}
`,
    python: `# Read input from stdin
def main():
    # Your code here
    pass

if __name__ == "__main__":
    main()
`,
    cpp: `#include <iostream>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    // Your code here
    return 0;
}
`,
    c: `#include <stdio.h>

int main() {
    // Your code here
    return 0;
}
`
  };

  const languageSelect = document.getElementById('language');

  // Wait until Monaco editor is ready
  function setEditorContentForLang() {
    if (window.editor && languageSelect) {
      const lang = languageSelect.value;
      const code = boilerplateCode[lang] || '';
      editor.setValue(code);
    }
  }

  // Initial load - insert boilerplate based on selected language
  window.addEventListener('DOMContentLoaded', () => {
    setEditorContentForLang();
  });

  // On language change, update boilerplate snippet
  languageSelect.addEventListener('change', () => {
    setEditorContentForLang();
  });
</script>



{% endblock %}