{% extends 'base.html' %}
{% load static %}

{% block title %}Online Compiler ‚Äì CodeVerse{% endblock %}

{% block content %}
<style>
  .compiler-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 1rem;
  }

  #editor {
    height: 400px;
    border: 1px solid #007bff;
    border-radius: .5rem;
    margin-bottom: 1rem;
  }

  .settings-row {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 1rem;
  }

  .settings-row select {
    width: auto;
  }

  .form-section textarea {
    font-family: monospace;
  }

  .form-section label {
    font-weight: 500;
    margin-top: 0.5rem;
  }

  #custom-input,
  #custom-output {
    background: #fff;
    color: #000;
  }

  .btn-run {
    white-space: nowrap;
  }

  /* Add this to your existing <style> in online_compiler.html */
    .compiler-container::-webkit-scrollbar,
    #editor::-webkit-scrollbar,
    textarea::-webkit-scrollbar {
      width: 6px;
    }
    .compiler-container::-webkit-scrollbar-thumb,
    #editor::-webkit-scrollbar-thumb,
    textarea::-webkit-scrollbar-thumb {
      background-color: #4da6ff;
      border-radius: 3px;
    }

    .monaco-scrollable-element > .scrollbar > .slider {
        background: #4da6ff !important;
        border-radius: 3px !important;
      }

      /* Scrollbar for entire page */
      body::-webkit-scrollbar,
      .compiler-container::-webkit-scrollbar,
      #editor::-webkit-scrollbar,
      textarea::-webkit-scrollbar {
        width: 6px;
      }
      
      /* Stylish blue thumb */
      body::-webkit-scrollbar-thumb,
      .compiler-container::-webkit-scrollbar-thumb,
      #editor::-webkit-scrollbar-thumb,
      textarea::-webkit-scrollbar-thumb {
        background-color: #4da6ff;
        border-radius: 3px;
      }
      .text-primary {
        color: #4da6ff !important;
      }
      
      .fw-bold {
        font-weight: 600;
      }
      
          
</style>

<div class="text-center mb-4">
    <h2 class="fw-bold text-primary">
      <img src="{% static 'images/codeverse-logo.png' %}" height="40" class="me-2" style="vertical-align: middle;" />
      CodeVerse Online Compiler
    </h2>
    <p class="text-muted mt-2 mb-0">
      Code in <strong>Python</strong>, <strong>C</strong>, <strong>C++</strong>, or <strong>Java</strong>.  
      Set limits. Add input. Get verdicts. All in one elegant workspace.
    </p>
  </div>
  

<div class="compiler-container">
  <div>
    <select id="language" class="form-select w-auto mb-2">
        <option value="cpp">C++</option>
        <option value="python">Python</option>
        <option value="java">Java</option>
      <option value="c">C</option>
    </select>
    <div id="editor"></div>
  </div>

  <div class="settings-row">
    <label>‚è± Time:</label>
    <select id="time-limit" class="form-select form-select-sm">
      <option value="1">1s</option>
      <option value="2">2s</option>
      <option value="3">3s</option>
      <option value="4">4s</option>
      <option value="5">5s</option>
    </select>

    <label>üíæ Memory:</label>
    <select id="memory-limit" class="form-select form-select-sm">
      <option value="128">128MB</option>
      <option value="256">256MB</option>
      <option value="384">384MB</option>
      <option value="512">512MB</option>
    </select>

    <button id="run-button" class="btn btn-outline-primary btn-sm ms-auto btn-run">
      ‚ñ∂Ô∏è Run Code
    </button>
  </div>

  <div class="form-section">
    <label for="custom-input">üì• Custom Input:</label>
    <textarea id="custom-input" class="form-control" rows="3" placeholder="Enter input‚Ä¶"></textarea>

    <label for="custom-output">üì§ Output:</label>
    <textarea id="custom-output" class="form-control" rows="4" readonly></textarea>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script>
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    window.editor = monaco.editor.create(document.getElementById('editor'), {
      value: '',
      language: 'java',
      theme: 'vs-dark',
      automaticLayout: true,
      minimap: { enabled: false },
      scrollbar: {
        verticalScrollbarSize: 4,
        horizontalScrollbarSize: 4,
        useShadows: false,
      }
    });


    // boilerplate snippets
    const boilerplate = {
        java: `import java.util.*;
  
public class Main {
    public static void main(String[] args) {
        // Your code here

    }
}
  `,
        python: `# Python3 code

def main():
    # Your code here
    

    pass

if __name__ == "__main__":
    main()
  `,
        cpp: `#include <bits/stdc++.h>
using namespace std;

int main() {

    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    // Your code here


    return 0;
}
  `,
        c: `#include <stdio.h>
  
int main() {

    // Your code here


    return 0;
}
  `
    };

    const langSelect = document.getElementById('language');
    langSelect.addEventListener('change', () => {
      const lang = langSelect.value;
      editor.setValue(boilerplate[lang] || '');
      monaco.editor.setModelLanguage(editor.getModel(), lang === 'cpp' ? 'cpp' : lang);
    });

    langSelect.dispatchEvent(new Event('change'));

    document.getElementById('run-button').addEventListener('click', () => {
      const code = editor.getValue();
      const language = langSelect.value;
      const custom_input = document.getElementById('custom-input').value;
      const time_limit = document.getElementById('time-limit').value;
      const memory_limit = document.getElementById('memory-limit').value;

      const data = new FormData();
      data.append('code', code);
      data.append('language', language);
      data.append('custom_input', custom_input);
      data.append('time_limit', time_limit);
      data.append('memory_limit', memory_limit);

      fetch('/run-code/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: data
      })
      .then(res => res.json())
      .then(json => {
        document.getElementById('custom-output').value =
          json.output || json.details || json.error || '';
      });
    });
  });
</script>
{% endblock %}
